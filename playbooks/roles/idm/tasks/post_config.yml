- name: add users to IDM
  ipa_user:
    ipa_host: "{{ rhel_idm.hostname_short }}.{{ domain }}"
    ipa_user: admin
    ipa_pass: "{{ rhel_idm.admin_pwd }}"
    state: present
    uid: "{{ item.username }}"
    password: "{{ item.password }}"
    displayname: "{{ item.display_name }}"
    givenname: "{{ item.first_name }}"
    sn: "{{ item.last_name }}"
    title: "{{ item.title }}"
    mail:
    - "{{ item.email }}"
    telephonenumber:
    - "{{ item.phone }}"
  with_items:
    - "{{ rhel_idm.users }}"
  tags: post-config

- name: add forward DNS entries to IDM
  ipa_dnsrecord:
    ipa_host: "{{ rhel_idm.hostname_short }}.{{ domain }}"
    ipa_user: admin
    ipa_pass: "{{ rhel_idm.admin_pwd }}"
    state: present
    zone_name: "{{ domain }}"
    record_name: "{{ item.hostname }}"
    record_type: "A"
    record_value: "{{ item.ip_address }}"
    record_ttl: 500
  with_items:
    - "{{ rhel_idm.dns_records }}"
  tags: post-config

- name: add reverse DNS entries to IDM
  ipa_dnsrecord:
    ipa_host: "{{ rhel_idm.hostname_short }}.{{ domain }}"
    ipa_user: admin
    ipa_pass: "{{ rhel_idm.admin_pwd }}"
    state: present
    zone_name: "{{ rhel_idm.reverse_zone }}"
    record_name: "{{ item.reverse_record }}"
    record_type: 'PTR'
    record_value: "{{ item.hostname }}.{{ domain }}"
    record_ttl: 500
  with_items:
    - "{{ rhel_idm.dns_records }}"
  tags: post-config
